# v0.5.6 发布说明

**发布日期**: 2025年12月20日

## 版本概述

v0.5.6 版本主要聚焦于Bug管理功能优化、界面层级问题修复、工作报告功能增强以及日志导出功能改进。通过修复多个UI层级问题、优化Bug查询功能、增强工作报告统计，提升了系统的用户体验和功能完整性。

## 主要更新

### Bug管理功能优化 🐛

#### Bug列表和查询增强
- **添加Bug编号列**
  - 在Bug列表和详情界面显示编号
  - 编号列宽度固定为60px，优化显示效果
  - 便于快速识别和定位Bug

- **优化Bug查询功能**
  - 添加更新日期筛选功能
  - 指派给支持项目成员和所有用户
  - 指派给我功能不受项目限制
  - 优化查询表单布局：字段标签和输入同一行
  - 优化搜索栏布局：查询和重置按钮靠右对齐

#### Bug统计修复
- **修复工作台Bug统计**
  - 使用Model确保过滤软删除记录
  - 确保统计数据的准确性

### 界面层级问题修复 🎨

#### 弹窗层级优化
- **修复Bug详情界面图片预览窗口被遮挡**
  - 提高图片预览和附件预览的z-index到2300
  - 确保预览窗口始终显示在最上层

- **修复Bug管理页模态框层级问题**
  - 修复指派窗口被详情窗口遮挡的问题
  - 统一设置z-index避免弹窗相互遮挡

- **修复详情界面弹窗层级**
  - 统一设置z-index，确保弹窗显示顺序正确
  - 提升用户体验

### 工作报告功能增强 📊

#### 统计功能优化
- **添加解决的Bug统计**
  - 在工作报告中显示已解决的Bug数量
  - 增强工作报告的完整性
  - 便于工作成果展示

### 日志导出功能改进 📝

#### 导出功能优化
- **支持导出完整内容为PNG**
  - 修复日志导出功能，支持导出完整内容（不仅仅是视口可见部分）
  - 添加html2canvas依赖包
  - 优化导出图片质量

- **修复写日志路由问题**
  - 修复需要先点击"工作台"再点击"写日志"才能显示"新增日报"的问题
  - 添加路由监听器，确保从任何页面点击"写日志"都能自动打开新增日报对话框
  - 提升用户体验

### 系统稳定性提升 🔧

#### 数据库优化
- **修复数据库死锁问题**
  - 使用事务和FirstOrCreate防止并发死锁
  - 提升系统并发处理能力
  - 确保数据一致性

#### 审计日志增强
- **修复微信登录审计日志**
  - 记录IP和请求路径
  - 增强安全审计能力
  - 便于问题追踪和排查

## 技术细节

### 数据库变更
- 无数据库结构变更

### API变更
- 无破坏性API变更
- 工作报告API增加Bug统计字段（向后兼容）

### 依赖更新
- **前端依赖**
  - 新增 `html2canvas@^1.4.1`（用于图片导出功能）

### 涉及文件

#### 后端
- `backend/internal/api/report.go` - 工作报告功能增强，添加Bug统计
- `backend/internal/api/bug.go` - Bug查询功能优化
- `backend/internal/api/audit_log.go` - 审计日志增强
- `backend/internal/model/*.go` - 数据库死锁修复

#### 前端
- `frontend/src/views/bug/Bug.vue` - Bug列表和查询功能优化
- `frontend/src/components/MarkdownEditor.vue` - 日志导出功能改进
- `frontend/src/views/report/Report.vue` - 工作报告功能增强，路由问题修复
- `frontend/src/views/dashboard/Dashboard.vue` - Bug统计修复
- `frontend/package.json` - 添加html2canvas依赖

## 升级说明

### 升级步骤
1. **更新代码**：拉取最新代码
2. **前端更新**：需要重新构建前端
   ```bash
   cd frontend
   npm install  # 安装新的依赖包
   npm run build
   ```
3. **后端更新**：需要重新编译后端
   ```bash
   cd backend
   go build -o server cmd/server/main.go
   ```

### 兼容性
- **向后兼容**：完全兼容 v0.5.5
- **API兼容**：所有API保持向后兼容
- **数据兼容**：无需数据迁移

### 注意事项
- 本次更新主要优化Bug管理功能和修复UI问题，建议所有用户升级
- 新增html2canvas依赖，前端需要重新安装依赖并构建
- Bug查询功能增强，支持更灵活的筛选条件
- 工作报告功能增强，显示更多统计信息

## 统计信息

- **提交数量**：13个提交
- **主要功能**：
  - Bug管理功能优化（5项）
  - 界面层级问题修复（3项）
  - 工作报告功能增强（1项）
  - 日志导出功能改进（2项）
  - 系统稳定性提升（2项）

### 功能改进
- **Bug管理**：添加编号列、优化查询功能、修复统计问题
- **UI优化**：修复3个弹窗层级问题
- **工作报告**：添加Bug统计功能
- **日志导出**：支持导出完整内容为PNG
- **系统稳定性**：修复数据库死锁、增强审计日志

---

**版本号**: v0.5.6  
**发布日期**: 2025年12月20日  
**兼容性**: 向后兼容 v0.5.5  
**建议升级**: ✅ 是（Bug管理优化和UI问题修复）

