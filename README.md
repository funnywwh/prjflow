# 项目管理系统

基于Go + Gin + GORM和Vue3 + TypeScript + Ant Design Vue的全栈项目管理软件。

## 技术栈

- **后端**: Go + Gin + GORM + SQLite（支持MySQL）
- **前端**: Vue 3 + TypeScript + Ant Design Vue + Vite
- **认证**: 微信开放平台扫码登录
- **测试**: TDD开发，单元测试覆盖率目标100%

## 项目结构

```
project/
├── backend/          # Go后端
│   ├── cmd/server/  # 应用入口
│   ├── internal/    # 内部包
│   │   ├── api/     # API路由层
│   │   ├── service/ # 业务逻辑层
│   │   ├── model/   # 数据模型
│   │   ├── repository/ # 数据访问层
│   │   ├── middleware/ # 中间件
│   │   └── utils/   # 工具函数
│   ├── pkg/         # 可复用包
│   └── migrations/  # 数据库迁移
└── frontend/        # Vue3前端
    └── src/
        ├── api/     # API接口
        ├── views/   # 页面组件
        ├── components/ # 公共组件
        ├── stores/  # 状态管理
        └── router/  # 路由配置
```

## 已完成功能

### 后端
- ✅ 项目初始化和基础架构
- ✅ 数据库模型设计（所有表结构）
- ✅ 微信登录集成
- ✅ JWT认证机制
- ✅ RBAC权限系统
- ✅ 系统初始化功能
  - ✅ 系统初始化状态检查
  - ✅ 微信配置保存（第一步）
  - ✅ 微信扫码初始化（第二步：通过微信登录创建管理员）
  - ✅ 密码登录初始化（第二步：通过用户名密码创建管理员）
  - ✅ 初始化二维码生成
  - ✅ WebSocket 扫码通知
- ✅ 静态文件服务（支持前端 SPA 路由）
- ✅ 用户管理API
  - ✅ 用户CRUD操作
  - ✅ 用户昵称功能（username用于登录，nickname用于显示）
  - ✅ 扫码添加用户功能
  - ✅ 软删除用户恢复机制
  - ✅ 并发创建用户冲突处理
- ✅ 部门管理API
- ✅ 角色和权限管理API
- ✅ 产品管理API（产品线、产品CRUD）
- ✅ 项目管理API（项目集、项目CRUD、成员管理、统计）
- ✅ 需求管理API（CRUD、状态流转、统计）
- ✅ Bug管理API（CRUD、状态流转、分配、统计）
- ✅ 任务管理API（CRUD、状态流转、进度管理、任务依赖关系）
  - ✅ 任务工时管理（预估工时、实际工时、自动计算进度）
  - ✅ 任务进度更新界面（支持预估工时、实际工时、工作日期）
  - ✅ 进度自动计算（实际工时/预估工时 * 100，范围0-100%）
  - ✅ 资源分配自动创建（更新实际工时时自动创建资源分配记录）
- ✅ 看板管理API（看板、列、任务拖拽排序）
- ✅ 甘特图API（任务时间线、依赖关系、进度可视化）
- ✅ 项目进度跟踪API（统计图表、进度报表）
- ✅ 版本管理API（版本CRUD，Markdown发布说明，关联需求和Bug）
- ✅ SQLite数据库迁移优化（支持NOT NULL字段添加）

### 前端
- ✅ 项目初始化和基础配置
- ✅ 路由配置和守卫
- ✅ 状态管理（Pinia）
- ✅ 登录页面（支持微信登录和密码登录，默认微信登录）
- ✅ 系统初始化页面（支持微信扫码和密码登录两种方式）
- ✅ 工作台页面框架
- ✅ API请求封装（TypeScript 类型完善）
- ✅ TypeScript 类型系统完善（所有类型错误已修复）
- ✅ 用户管理页面
  - ✅ 用户列表展示（显示格式：username(nickname)）
  - ✅ 用户编辑功能（支持昵称编辑）
  - ✅ 扫码添加用户功能
  - ✅ 添加用户后昵称设置对话框
- ✅ 项目管理页面（项目详情、统计、成员管理）
- ✅ 需求管理页面（列表、创建、编辑、详情、统计）
- ✅ Bug管理页面（列表、创建、编辑、详情、分配、统计）
- ✅ 任务管理页面（列表、创建、编辑、详情、进度管理、依赖关系）
  - ✅ 任务进度更新界面（预估工时、实际工时、工作日期）
  - ✅ 进度自动计算（根据工时实时计算）
  - ✅ 工时显示（显示当前实际工时）
- ✅ 看板页面（看板视图、拖拽排序、列管理）
- ✅ 甘特图页面（任务时间线、依赖关系、进度可视化）
- ✅ 进度跟踪页面（统计图表、进度报表、成员工作量）
- ✅ 版本管理页面（版本列表、创建、编辑、关联需求和Bug、状态管理）
- ✅ 版本详情页面（显示关联需求和Bug）
- ✅ 测试单管理页面（列表、创建、编辑、多测试类型选择、关联Bug）
- ✅ 测试报告管理页面（列表、创建、编辑、关联测试单）
- ✅ 资源统计页面（按项目和人员统计工时）
- ✅ Markdown编辑器组件

## 项目状态

### 已完成功能模块 ✅

1. ✅ **项目管理** - 项目管理，成员管理，项目统计，标签管理
2. ✅ **需求管理和Bug追踪** - 需求/Bug的CRUD、状态流转、分配、统计，Markdown支持
3. ✅ **任务管理和看板系统** - 任务CRUD、状态流转、进度管理、任务依赖、看板拖拽、甘特图、进度跟踪
5. ✅ **版本管理** - 版本管理、版本关联需求和Bug、状态管理
6. ✅ **任务工时管理** - 预估工时、实际工时、自动计算进度、资源分配自动创建

### 进行中 ⏳

- **测试管理** - 测试单、测试报告、测试单关联Bug和测试报告（部分完成）
- **资源管理** - 资源统计功能（已完成），资源分配通过任务和Bug工时自动管理

### 待开发功能 📋

1. **工作报告系统** - 日报、周报（支持Markdown）
2. **插件管理系统** - 插件安装、配置、前端界面支持、插件市场
3. **关系图生成** - 数据库ER图、业务关系图
4. **个人工作台** - 聚合显示用户相关事务
5. **单元测试补充** - 各模块测试覆盖率提升至100%

## 开发指南

### 后端开发

1. 启动开发服务器：
```bash
cd backend
go run cmd/server/main.go
```

服务器启动后会自动：
- 初始化数据库连接
- 执行数据库迁移
- 启动 API 服务（默认端口：8080）
- 提供静态文件服务（如果 frontend/dist 目录存在）

2. 运行测试：
```bash
go test ./...
```

3. 数据库迁移：
数据库会在启动时自动迁移（通过GORM AutoMigrate）

4. 静态文件服务：
后端会自动查找并服务前端构建后的静态文件（`frontend/dist`），支持 SPA 路由。

### 前端开发

1. 安装依赖：
```bash
cd frontend
npm install
```

2. 启动开发服务器：
```bash
npm run dev
```

3. 构建生产版本：
```bash
npm run build
# 或使用 yarn
yarn build
```

构建后的文件在 `frontend/dist` 目录，后端会自动服务这些静态文件。

## 配置说明

### 后端配置

编辑 `backend/config.yaml`：
- 数据库配置（SQLite或MySQL）
- JWT密钥
- 微信开放平台AppID和AppSecret
- 服务器端口等

### 前端配置

编辑 `frontend/.env`：
- API基础URL

## API文档

API采用RESTful风格，主要端点：

- `/api/init/*` - 系统初始化（检查状态、保存微信配置、完成初始化）
- `/api/auth/*` - 认证相关（登录、微信登录、用户信息）
- `/api/permissions/*` - 权限管理
- `/api/users/*` - 用户管理
- `/api/departments/*` - 部门管理
- `/api/projects/*` - 项目管理
- `/api/requirements/*` - 需求管理
- `/api/bugs/*` - Bug管理
- `/api/tasks/*` - 任务管理
- `/api/versions/*` - 版本管理
- `/api/test-cases/*` - 测试单管理
- `/api/test-reports/*` - 测试报告管理
- `/api/resources/*` - 资源管理
- `/api/boards/*` - 看板管理
- `/api/dashboard/*` - 工作台数据

详细 API 文档请参考 `docs/API设计文档.md`

## 开发规范

1. **TDD开发**：先写测试，再实现功能
2. **代码规范**：遵循Go和TypeScript最佳实践
3. **数据库兼容**：使用GORM抽象层，支持SQLite和MySQL
4. **Markdown支持**：需求、Bug、任务等模块支持Markdown格式

## 系统初始化

首次使用系统需要进行初始化：

1. **访问初始化页面**：系统会自动检测是否已初始化，未初始化会跳转到 `/init` 页面

2. **第一步：配置微信**（可选）
   - 输入微信开放平台的 AppID 和 AppSecret
   - 或跳过此步骤，直接使用密码登录初始化

3. **第二步：创建管理员**
   - **方式一：微信扫码**（默认）
     - 扫描二维码完成微信登录
     - 自动创建管理员账号（使用微信昵称）
   - **方式二：密码登录**
     - 输入用户名、密码、昵称
     - 创建管理员账号

初始化完成后，系统会生成 JWT Token，自动登录并跳转到工作台。

## 注意事项

- 数据库模型已全部定义，所有核心功能模块的API和前端页面已实现
- 微信登录需要配置真实的AppID和AppSecret（可选，也可以使用密码登录）
- 生产环境请修改JWT密钥和数据库配置
- 后端支持静态文件服务，可以直接部署后端服务，无需单独的 Web 服务器（如 Nginx）

## 下一步

按照计划继续实现剩余功能模块，每个模块遵循TDD开发流程：
1. 编写详细设计文档
2. 编写单元测试
3. 实现功能
4. 确保测试覆盖率100%

