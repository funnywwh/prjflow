# v0.4.15 发布说明

## 版本信息

- **版本号**: v0.4.15
- **发布日期**: 2025年12月4日
- **主要更新**: 按钮级权限控制

## 新功能

### 1. 按钮级权限控制

实现了完整的按钮级权限控制功能，支持在页面中根据用户权限动态显示/隐藏按钮。

#### 1.1 权限指令（v-permission）

创建了 `v-permission` 指令，可以在任何元素上使用，根据权限自动显示/隐藏。

**使用方式**：

```vue
<!-- 单个权限 -->
<a-button v-permission="'project:create'">创建项目</a-button>

<!-- 多个权限（任一即可） -->
<a-button v-permission="['project:create', 'project:update']">编辑项目</a-button>
```

**特性**：
- 支持单个权限代码或权限数组
- 权限数组时，只要有一个权限即可显示
- 自动响应权限变化，动态显示/隐藏
- 管理员自动拥有所有权限

#### 1.2 权限组件（PermissionButton）

创建了 `PermissionButton` 组件，提供组件方式的权限控制。

**使用方式**：

```vue
<PermissionButton permission="project:delete" tag="a-button" danger>
  删除项目
</PermissionButton>
```

**特性**：
- 支持自定义渲染标签（tag属性）
- 支持透传所有属性（使用 v-bind="$attrs"）
- 支持插槽内容

#### 1.3 已应用的页面

已在以下页面应用权限控制：

**项目页面（Project.vue）**：
- 新增项目按钮：`project:create`
- 编辑按钮：`project:update`
- 删除按钮：`project:delete`
- 成员管理按钮：`project:manage`

**Bug页面（Bug.vue）**：
- 新增Bug按钮：`bug:create`
- 编辑按钮：`bug:update`
- 删除按钮：`bug:delete`
- 指派按钮：`bug:assign`
- 确认/解决按钮：`bug:update`

**任务页面（Task.vue）**：
- 新增任务按钮：`task:create`
- 编辑按钮：`task:update`
- 删除按钮：`task:delete`
- 进度更新按钮：`task:update`
- 状态变更按钮：`task:update`

## 技术实现

### 文件结构

```
frontend/src/
├── directives/
│   └── permission.ts          # 权限指令实现
├── components/
│   └── PermissionButton.vue   # 权限组件
└── main.ts                     # 注册权限指令
```

### 权限检查逻辑

1. 从 `usePermissionStore` 获取用户权限列表
2. 检查用户角色，管理员自动拥有所有权限
3. 根据权限代码匹配，决定是否显示元素
4. 响应权限变化，动态更新显示状态

### 权限代码格式

权限代码采用 `资源:操作` 格式，例如：
- `project:create` - 创建项目
- `project:update` - 更新项目
- `project:delete` - 删除项目
- `project:read` - 查看项目
- `project:manage` - 管理项目
- `bug:create` - 创建Bug
- `bug:update` - 更新Bug
- `bug:delete` - 删除Bug
- `bug:assign` - 指派Bug
- `task:create` - 创建任务
- `task:update` - 更新任务
- `task:delete` - 删除任务

## 使用示例

### 示例1：单个权限

```vue
<template>
  <a-button v-permission="'project:create'" type="primary" @click="handleCreate">
    创建项目
  </a-button>
</template>
```

### 示例2：多个权限（任一即可）

```vue
<template>
  <a-button 
    v-permission="['project:create', 'project:update']" 
    @click="handleEdit"
  >
    编辑项目
  </a-button>
</template>
```

### 示例3：使用组件方式

```vue
<template>
  <PermissionButton 
    permission="project:delete" 
    tag="a-button" 
    danger
    @click="handleDelete"
  >
    删除项目
  </PermissionButton>
</template>
```

### 示例4：在表格操作列中使用

```vue
<template>
  <a-space>
    <a-button 
      v-permission="'bug:update'"
      type="link" 
      size="small" 
      @click="handleEdit(record)"
    >
      编辑
    </a-button>
    <a-button 
      v-permission="'bug:assign'"
      type="link" 
      size="small" 
      @click="handleAssign(record)"
    >
      指派
    </a-button>
    <a-popconfirm
      v-permission="'bug:delete'"
      title="确定要删除吗？"
      @confirm="handleDelete(record.id)"
    >
      <a-button type="link" size="small" danger>删除</a-button>
    </a-popconfirm>
  </a-space>
</template>
```

## 后续计划

以下页面的权限控制将在后续版本中完成：
- 需求页面（Requirement.vue）
- 测试用例页面（TestCase.vue）
- 附件上传/删除功能
- 用户管理、部门管理、权限管理页面

## 升级说明

### 前端升级

1. 无需修改现有代码，新功能向后兼容
2. 如需在新页面使用权限控制，参考使用示例
3. 权限指令已全局注册，可直接使用

### 权限配置

确保后端已配置相应的权限代码，权限代码格式为 `资源:操作`。

## 注意事项

1. **权限指令**：使用 `v-permission` 指令时，元素会在没有权限时隐藏（display: none）
2. **权限组件**：使用 `PermissionButton` 组件时，元素会完全移除（v-if）
3. **管理员权限**：管理员角色自动拥有所有权限，无需单独配置
4. **权限更新**：权限变化时会自动响应，无需手动刷新页面

## 相关文档

- [开发计划.md](./开发计划.md) - 查看完整的开发计划
- [权限管理设计文档.md](./权限管理设计文档.md) - 查看权限系统设计
- [API设计文档.md](./API设计文档.md) - 查看权限相关API

---

如有问题或建议，请联系开发团队。

