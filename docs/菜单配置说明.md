# 菜单配置说明

## 概述

系统支持在权限管理界面中配置菜单，菜单会根据用户的权限自动显示或隐藏。配置菜单后，用户只能看到有权限访问的菜单项。

## 配置步骤

### 1. 进入权限管理

登录系统后，点击导航栏的"权限管理"菜单，进入权限管理页面。

### 2. 编辑权限并配置菜单

1. 切换到"权限管理"标签页
2. 找到需要配置菜单的权限，点击"编辑"按钮
3. 在编辑对话框中，找到"是否显示在菜单"选项，开启开关
4. 配置菜单相关字段：
   - **菜单标题**：菜单显示的名称（留空则使用权限名称）
   - **菜单路径**：路由路径，如 `/project`、`/user` 等
   - **菜单图标**：Ant Design Vue 图标组件名称，如 `ProjectOutlined`、`UserOutlined` 等
   - **父菜单**：选择父菜单（留空则为顶级菜单，用于创建多级菜单）
   - **菜单排序**：数字越小越靠前，用于控制菜单显示顺序

### 3. 创建多级菜单

要创建多级菜单（父菜单+子菜单），需要：

1. 先创建父菜单权限：
   - 开启"是否显示在菜单"
   - 填写菜单标题和图标
   - **不填写菜单路径**（父菜单通常不直接跳转）
   - 不选择父菜单（作为顶级菜单）

2. 再创建子菜单权限：
   - 开启"是否显示在菜单"
   - 填写菜单标题、路径和图标
   - **选择父菜单**（选择刚才创建的父菜单）

### 4. 为角色分配权限

1. 切换到"角色管理"标签页
2. 找到需要配置的角色，点击"分配权限"
3. 在权限树中选择该角色需要的权限（包括菜单权限）
4. 点击"确定"保存

## 示例配置

### 示例1：单级菜单

创建一个"项目管理"菜单：

- 权限代码：`project:read`
- 权限名称：`查看项目`
- 是否显示在菜单：**开启**
- 菜单标题：`项目管理`
- 菜单路径：`/project`
- 菜单图标：`ProjectOutlined`
- 父菜单：**留空**（顶级菜单）
- 菜单排序：`10`

### 示例2：多级菜单

创建"项目管理"父菜单和"项目列表"子菜单：

**父菜单配置：**
- 权限代码：`project:read`
- 权限名称：`查看项目`
- 是否显示在菜单：**开启**
- 菜单标题：`项目管理`
- 菜单路径：**留空**（父菜单不跳转）
- 菜单图标：`ProjectOutlined`
- 父菜单：**留空**（顶级菜单）
- 菜单排序：`10`

**子菜单配置：**
- 权限代码：`project:list`
- 权限名称：`项目列表`
- 是否显示在菜单：**开启**
- 菜单标题：`项目列表`
- 菜单路径：`/project`
- 菜单图标：`ProjectOutlined`
- 父菜单：**选择"查看项目"权限**
- 菜单排序：`1`

## 注意事项

1. **权限与菜单的关系**：
   - 只有开启了"是否显示在菜单"的权限才会显示在导航栏
   - 用户必须拥有该权限才能看到对应的菜单项
   - 如果用户没有权限，菜单会自动隐藏

2. **菜单权限与操作权限的分离**：
   - **菜单权限**：控制菜单的显示，通常以 `:menu` 结尾（如 `user:menu`、`requirement:menu`）
   - **操作权限**：控制 API 的访问，通常以 `:read`、`:create`、`:update`、`:delete` 等结尾（如 `user:read`、`requirement:read`）
   - 菜单权限和操作权限是独立的，需要分别分配
   - 例如：用户需要 `user:menu` 权限才能看到"用户管理"菜单，需要 `user:read` 权限才能访问用户列表 API
   - 如果用户只有操作权限而没有菜单权限，可以访问 API 但看不到菜单
   - 如果用户只有菜单权限而没有操作权限，可以看到菜单但无法访问 API（会返回 403 错误）

2. **父菜单显示规则**：
   - 如果父菜单的所有子菜单都被隐藏（用户没有权限），父菜单也会被隐藏
   - 如果父菜单有路径且子菜单被隐藏，父菜单会作为单级菜单显示

3. **菜单排序**：
   - 数字越小越靠前
   - 相同排序值的菜单按创建时间排序

4. **图标名称**：
   - 使用 Ant Design Vue 的图标组件名称
   - 常见图标：`DashboardOutlined`、`ProjectOutlined`、`UserOutlined`、`SettingOutlined`、`TeamOutlined` 等
   - 图标名称必须以 `Outlined`、`Filled` 或 `TwoTone` 结尾

5. **管理员权限**：
   - 管理员（admin角色）自动拥有所有权限，可以看到所有菜单

## 菜单显示逻辑

1. 系统首先从后端获取用户有权限的菜单配置
2. 如果后端菜单加载失败，会使用前端静态配置作为后备方案
3. 菜单根据用户的权限动态显示/隐藏
4. 菜单按排序字段排序显示

## 常见问题

**Q: 为什么菜单不显示？**
A: 检查以下几点：
- 权限是否开启了"是否显示在菜单"
- 用户是否拥有该权限
- 权限状态是否为"正常"
- 角色是否已分配该权限

**Q: 如何修改菜单顺序？**
A: 编辑权限，修改"菜单排序"字段，数字越小越靠前。

**Q: 如何创建多级菜单？**
A: 先创建父菜单权限（不填写路径），再创建子菜单权限（选择父菜单）。

**Q: 菜单图标不显示？**
A: 检查图标名称是否正确，必须是 Ant Design Vue 支持的图标组件名称。

**Q: 为什么我分配了 user:read 权限，但看不到"用户管理"菜单？**
A: `user:read` 是操作权限，用于控制 API 访问。要显示菜单，需要分配 `user:menu` 权限。菜单权限和操作权限是分离的，需要分别分配。

**Q: 菜单权限和操作权限有什么区别？**
A: 
- **菜单权限**（如 `user:menu`）：控制菜单的显示，用户拥有此权限才能看到对应的菜单项
- **操作权限**（如 `user:read`、`user:create`）：控制 API 的访问，用户拥有此权限才能执行对应的操作
- 两者是独立的，需要分别分配。建议同时分配菜单权限和对应的操作权限。

